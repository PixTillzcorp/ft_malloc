/******************************************************************************/
/*____________________________________________________________________________*/
/*_____/\/\/\/\/\___/\/\____________/\/\/\/\/\/\_/\/\__/\/\__/\/\_____________*/
/*____/\/\____/\/\_______/\/\__/\/\____/\/\___________/\/\__/\/\__/\/\/\/\/\__*/
/*___/\/\/\/\/\___/\/\____/\/\/\______/\/\_____/\/\__/\/\__/\/\______/\/\_____*/
/*__/\/\_________/\/\____/\/\/\______/\/\_____/\/\__/\/\__/\/\____/\/\________*/
/*_/\/\_________/\/\__/\/\__/\/\____/\/\_____/\/\__/\/\__/\/\__/\/\/\/\/\_____*/
/*____________________________________________________________________________*/
/*                                                                            */
/*----- Date ----------------{ 2019-09-30 15:39:38 }--------------------------*/
/*----- Author --------------{ PixTillz }-------------------------------------*/
/*----- Last Modified by ----{ hippolyteeinfalt }-----------------------------*/
/*----- Last Modified time --{ 2019-10-10 12:23:44 }--------------------------*/
/******************************************************************************/

#include "../includes/malloc.h"

void			free_core(void *ptr)
{
	t_block		*ref;

	if (g_page && ptr) {
        if (!(ref = find_block_addr(&g_page, ptr)))
            return;
        if (ref->freed) {
            ft_putendl("Double free.");
            return;
        } else
            ref->freed = 1;
        em_free_block(g_page, g_page->block, NULL, 0);
    }
}


void			free(void *ptr)
{
    pthread_mutex_lock(&g_mutex);
    free_core(ptr);
    pthread_mutex_unlock(&g_mutex);
}